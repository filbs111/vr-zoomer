<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>

    <script type="text/javascript" src="lib/dat.gui.min.js"></script>
    <script type="text/javascript" src="lib/stats.min.js"></script>
    <script type="text/javascript" src="lib/gl-matrix-min.js"></script>
    <script type="text/javascript" src="utils/webgl_utils.js"></script>
    <script type="text/javascript" src="utils/keys.js"></script>
    <script type="text/javascript" src="data/sphere.js"></script>
    <script type="text/javascript" src="data/levelCubeData.js"></script>
    

    <script id="shader-simple-vs" type="x-shader/x-vertex">
        attribute vec3 aVertexPosition;
        attribute vec3 aVertexNormal;
        attribute vec2 aTextureCoord;
        uniform mat4 uMVMatrix;
        uniform mat4 uPMatrix;
        uniform vec3 uModelScale;
        varying vec2 vTextureCoord;
        varying float light;
        
        void main(void) {
            vec4 transformedCoord = uMVMatrix * vec4(uModelScale*aVertexPosition, 1.0);
            gl_Position = uPMatrix * transformedCoord;
    
            vTextureCoord = aTextureCoord;

            light = dot(aVertexNormal, vec3(sqrt(.2),sqrt(.7),sqrt(.1))); //fixed in cube frame. TODO allow cube to rotate. either wants light pos/dir in cube frame, or pass in mMatrix

            light = .5*(light+1.);
        }
    </script>

    <script id="shader-simple-fs" type="x-shader/x-fragment">    
        precision mediump float;
        uniform vec4 uColor;
        uniform sampler2D uSampler;
        varying vec2 vTextureCoord;
        varying float light;
        
        void main(void) {
            gl_FragColor = uColor * texture2D(uSampler, vTextureCoord) * vec4( vec3(light), 1.0);
        }
    </script>


    <script id="shader-fullscreen-vs" type="x-shader/x-vertex">
        attribute vec3 aVertexPosition;
        varying vec3 vTextureCoord;
        
        void main(void) {
            gl_Position = vec4(aVertexPosition, 1.0);
            vTextureCoord = aVertexPosition * vec3(-1.,-1.,1.);
        }
    </script>
    
    <script id="shader-fullscreen-fs" type="x-shader/x-fragment">
        precision mediump float;
        varying vec3 vTextureCoord;
        uniform samplerCube uSampler;
        
        void main(void) {
            gl_FragColor = textureCube(uSampler, vTextureCoord);
        }
    </script>


    <script id="shader-simple-cmap-vs" type="x-shader/x-vertex">
        uniform mat4 uMVMatrix;
        uniform mat4 uPMatrix;
        attribute vec3 aVertexPosition;
        varying vec3 vTextureCoord;
        
        void main(void) {
            vec3 invertedCoords = vec3(1.0,1.0,-1.0) * aVertexPosition; //todo handle this in vertex data, or change backface culling setting
            vec4 transformedCoord = uMVMatrix * vec4(invertedCoords, 1.0);
            gl_Position = uPMatrix * transformedCoord;

            vTextureCoord = invertedCoords * vec3(-1.,-1.,1.);
        }
    </script>
    
    <script id="shader-simple-cmap-fs" type="x-shader/x-fragment">
        precision mediump float;
        varying vec3 vTextureCoord;
        uniform samplerCube uSampler;
        
        void main(void) {
            gl_FragColor = textureCube(uSampler, vTextureCoord);
        }
    </script>


    <script src='main.js'></script>

</head>
<body onload="init()">
    <canvas id="mycanvas"></canvas>
</body>
</html>